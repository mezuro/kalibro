FROM metrics, file_links
  JOIN scmlog as link_commit ON link_commit.id = file_links.commit_id
  JOIN scmlog as metric_commit ON metric_commit.id = metrics.commit_id
WHERE metrics.file_id = file_links.file_id
  AND metric_commit.date = (
    SELECT max(m_commit.date)
    FROM metrics as m
    JOIN scmlog as m_commit ON m_commit.id = m.commit_id
    WHERE m.file_id = metrics.file_id)
  AND link_commit.date = (
    SELECT max(l_commit.date)
    FROM file_links as l
    JOIN scmlog as l_commit ON l_commit.id = l.commit_id
    WHERE l.file_id = file_links.file_id)